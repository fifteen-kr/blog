---
draft: true
title: "PS용 파이썬 성능 최적화 #1: 프로파일링"
date: 2025-08-01
tags: [ps, python, optimization]
---

## 개요

이 시리즈는 프로그래밍 문제를 CPython으로 풀 때 어떻게 실행 시간을 최적화할 수 있는지를 다룹니다.
참고로, 이 시리즈에서는 메모리 사용량보다는 실행 시간을 줄이는 것에만 집중합니다.

파이썬 코드의 성능을 높이는 제일 간단한 방법은 PyPy를 이용하는 것입니다.
그렇기에 PS를 하는 대다수의 사람은 PyPy를 구현체로 이용합니다.

하지만 이 시리즈에서는 CPython만을 다루겠습니다. 제가 거의 CPython만 쓰기 때문입니다.
여기에는 여러 가지 이유가 있지만, 사실 PyPy 세팅이 귀찮은 게 제일 큽니다....[^1]

더 빠른 CPython 코드를 작성하는 법은 파고들면 생각보다 매우 까다로우며, 블로그 글 하나로는 다 다룰 수 없습니다.
이 글에서는 파이썬 코드를 프로파일링 하는 방법에 대해 다루고, 다음 글부터는 기초적인 팁과 빠른 입출력에 대한 내용부터 다루어 보려고 합니다.

## 프로파일링 하기

실행 시간을 줄이기 위해 최적화를 할 때에는, 감으로 찍거나 원인/결과를 막연히 예상해서는 안 됩니다. 생각보다 예상치 못하게 프로그램의 성능에 영향을 주는 요소가 많거든요.

이 시리즈에서 다룰 팁들도 사실 "일반적으로는 이렇다~" 정도의 내용입니다. 실제로 적용을 하려고 하면, 실제로 프로파일링을 해서 실행 시간이 개선되었는지 검증하는 것이 매우 중요합니다.
이 조언은 파이썬에만 적용되는 것이 아니고, 일반적인 상황에서 최적화를 할 때 항상 적용됩니다. 실험하는 습관을 기릅시다.

그렇다면, 파이썬 코드의 실행 시간은 어떻게 측정할 수 있을까요?

### `time`

제일 단순한 방법으로는 `time` 모듈을 `for` 루프와 함께 사용하는 것입니다.

```py
# 벤치마크 할 함수
arr = list(range(1_000_000))

def add_1():
    total = 0
    for x in arr: total += x
    return total

def add_2():
    return sum(arr)

# 실행 시간 측정
from time import time

for func in [add_1, add_2]:
    t_start = time()
    for _ in range(100): func()
    t_end = time()

    print(f"{func.__name__}:", t_end - t_start)
```

이 방법의 장점은, 무엇보다 세팅이 간단하다는 점입니다.

실행 시간을 측정하고 싶은 코드 앞뒤로 `t_start = time()`, `t_end = time(); print(t_end - t_start)`만 적으면 되니까요.

하지만 이 간단한 방식에는 많은 문제들이 도사리고 있습니다.

- 가비지 컬렉션이 시간에 영향을 줄 수 있기 때문에, 비활성화 시켜 놓아야 합니다.
  - 사실, 밑에서 다시 언급하겠지만, 가비지 컬렉터는 항상 꺼 놓으면 됩니다.
- 측정할 때 (패키지를 임포트 할 때 IO라던가...) 여러 가지 외부 요인으로 인해, 편차가 발생할 수 있습니다.
- 실행 시간이 짧은 코드를 돌릴 때, 루프 오버헤드가 클 수 있습니다.
- `time.time()`은 사실 실행 시간을 측정할 때 부적절합니다.
  - 윤초 등의 영향을 받을 수 있습니다.
  - 시스템 시간이 변경되면, 그 영향을 받을 수 있습니다.
  - 초 단위 미만의 정밀도로 제공되지 않을 수 있습니다. (`time.time_ns()`를 쓰면 해결 가능합니다.)

즉, 단순히 실행 시간의 근사치를 얻는 것 이상으로, 구체적으로 두 함수의 실행 시간을 비교한다거나 하는 목적으로는 적합하지 않을 수 있습니다.

다행히도, 파이썬에서는 더 장확한 프로파일링을 위한 모듈을 제공하고 있습니다.

### `timeit`

이 방식의 한 가지 큰 문제는, 코드의 전체 실행 시간만을 측정할 수 있을 뿐, 구체적으로 어떤 요소가 시간을 제일 잡아먹는지 쉽게 측정할 수 없다는 점입니다.

### `cProfile`

### `line_profiler`

<https://github.com/pyutils/line_profiler>
